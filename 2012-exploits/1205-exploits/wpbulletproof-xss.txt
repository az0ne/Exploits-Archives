-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Wordpress Security audit
BulletProof Security

1. Cross-site scripting (reflected)

Summary

Severity:   	High
Confidence:   	Certain
Host:   	http://127.0.0.1
Path:   	/wp-admin/admin.php?page=bulletproof-security/admin/options.php

Issue detail

The value of the Accept-Encoding HTTP header is copied into the HTML
document as plain text between tags. The payload
a7123<script>alert(1)</script>78089b4648b was submitted in the
Accept-Encoding HTTP header. This input was echoed unmodified in the
application's response.

This proof-of-concept attack demonstrates that it is possible to
inject arbitrary JavaScript into the application's response.
Issue background Reflected cross-site scripting vulnerabilities arise
when data is copied from a request and echoed into the application's
immediate response in an unsafe way. An attacker can use the
vulnerability to construct a request which, if issued by another
application user, will cause JavaScript code supplied by the attacker
to execute within the user's browser in the context of that user's
session with the application.

The attacker-supplied code can perform a wide variety of actions, such
as stealing the victim's session token or login credentials,
performing arbitrary actions on the victim's behalf, and logging their
keystrokes.

Users can be induced to issue the attacker's crafted request in
various ways. For example, the attacker can send a victim a link
containing a malicious URL in an email or instant message. They can
submit the link to popular web sites that allow content authoring, for
example in blog comments. And they can create an innocuous looking web
site which causes anyone viewing it to make arbitrary cross-domain
requests to the vulnerable application (using either the GET or the
POST method).

The security impact of cross-site scripting vulnerabilities is
dependent upon the nature of the vulnerable application, the kinds of
data and functionality which it contains, and the other applications
which belong to the same domain and organisation. If the application
is used only to display non-sensitive public content, with no
authentication or access control functionality, then a cross-site
scripting flaw may be considered low risk. However, if the same
application resides on a domain which can access cookies for other
more security-critical applications, then the vulnerability could be
used to attack those other applications, and so may be considered high
risk. Similarly, if the organisation which owns the application is a
likely target for phishing attacks, then the vulnerability could be
leveraged to lend credibility to such attacks, by injecting Trojan
functionality into the vulnerable application, and exploiting users'
trust in the organisation in order to capture credentials for other
applications which it owns. In many kinds of application, such as
those providing online banking functionality, cross-site scripting
should always be considered high risk.
Issue remediation In most situations where user-controllable data is
copied into application responses, cross-site scripting attacks can be
prevented using two layers of defences:

Input should be validated as strictly as possible on arrival, given
the kind of content which it is expected to contain. For example,
personal names should consist of alphabetical and a small range of
typographical characters, and be relatively short; a year of birth
should consist of exactly four numerals; email addresses should match
a well-defined regular expression. Input which fails the validation
should be rejected, not sanitised.
User input should be HTML-encoded at any point where it is copied into
application responses. All HTML metacharacters, including < > " ' and
=, should be replaced with the corresponding HTML entities (&lt; &gt;
etc).

In cases where the application's functionality allows users to author
content using a restricted subset of HTML tags and attributes (for
example, blog comments which allow limited formatting and linking), it
is necessary to parse the supplied HTML to validate that it does not
use any dangerous syntax; this is a non-trivial task.

Request
GET /wp-admin/admin.php?page=bulletproof-security/admin/options.php
HTTP/1.1
Host: 127.0.0.1
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:11.0)
Gecko/20100101 Firefox/11.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip, deflatea7123<script>alert(1)</script>78089b4648b
Proxy-Connection: keep-alive
Referer:
http://127.0.0.1/wp-admin/options-general.php?page=custom-field-template.php
Cookie:
wordpress_5c016e8f0f95f039102cbe8366c5c7f3=admin%7C1334178029%7C0bc36ed70eff4d014b8f8f399e7931d9;
bb2_screener_=1334010184+127.0.0.1;
PHPSESSID=r0pobhl4p21uu57ek6lpdabr76;
wordpress_test_cookie=WP+Cookie+check;
wp-settings-1=widgets_access%3Doff%26uploader%3D127;
wp-settings-time-1=1334005698;
wordpress_logged_in_5c016e8f0f95f039102cbe8366c5c7f3=admin%7C1334178029%7C68a0d9df0911bd2b367c681b0981811a
Pragma: no-cache
Cache-Control: no-cache

Response
HTTP/1.1 200 OK
Date: Mon, 09 Apr 2012 22:25:01 GMT
Server: Apache/2.2.20 (Ubuntu)
X-Powered-By: PHP/5.3.6-13ubuntu3.6
Set-Cookie: bb2_screener_=1334010301+127.0.0.1; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Last-Modified: Mon, 09 Apr 2012 22:25:01 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0,
pre-check=0
Pragma: no-cache
X-Frame-Options: SAMEORIGIN
Vary: Accept-Encoding
Content-Length: 167804
Content-Type: text/html; charset=UTF-8


<!DOCTYPE html>
<!--[if IE 8]>
<html xmlns="http://www.w3.org/1999/xhtml" class="ie8"  dir="ltr"
lang="en-US">
<![endif]-->
<!--[if !(IE 8) ]><!-->
<html xmlns="http://www.w3.org/1999/xhtml"  dir="ltr" lang="en-US">
<!--<![endif]-->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>BulletProof Security ~ htaccess Core &lsaquo; redteam-wp
&#8212; WordPress</title>
...[SNIP]...
  <tr>
    <td class="bps-table_cell">Browser Compression Supported:
<strong>gzip, deflatea7123<script>alert(1)</script>78089b4648b</td>
    <td>&nbsp;</td>
    <td class="bps-table_cell">&nbsp;</td>
    </tr>
  <tr>
...[SNIP]...

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)

iQIcBAEBAgAGBQJPrDi5AAoJEJPBwXYLR9VtZrMP/inAJrfCt8LiQC9DTAjjxtKb
64ufF5HnwxIkVP0iRhIrVB72OoPhgAA/M9G0x1ZtcuImRSSwqBmPRXiXb2FojQMl
xA7IM7P36cVdrtvRTZjFGzgC7zCJ40f3n+AJdAqaSzacVZ9E25McD1pZZlXOcdq6
5aMYg3LOXBMBFyrsOu+VenVDa1sbviuT+ZqFTx7DlE6EkXrdmFLHuUS3lUXlsrfK
DWlQBbbu98n9OGY/31pPvB73X2Z0K5H+7dz5ySfTjKJLJgy8tjSACX1iIEfv6z9e
npWVSBfr9c01GjfY1ACKRx12tPGF8j6xns2qDZOYiP8s/vxlDM/e+2Dpp9x4o8PP
5J2iI+RppJRjHK70BNzEfheXs6g+0BXLXzF7vIxXuVeBqQAodleJhMtbFvKyJ9ki
tNdz0ucpBY2zxGpFw6THW2QYLGh9oGN++KP6AI/ZQVIMCuHiD0elQWQLEY2wIr28
FJXghkDZRUxIQZK4uPhHuaQ7E9gecVJm19CDfcaJ2L35iX9YbalfOAbgOyMlIBy3
DkgXLgMYbdeTBBCh3nHZutMsvqsAPndqwhQQ2nWCjQV7wLd69uk6c1LYRx1dIAGs
H8YjgFPYhlXDlxTpyo1Nf0bGGNGFGatffhklVmUD4n1kzG2Py1wCYCzNzi3VZYy3
kkbQdNSxkSDQoiREHl/q
=cZih
-----END PGP SIGNATURE-----
